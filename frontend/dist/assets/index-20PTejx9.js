import{r as d,j as e,u as V,b as Se,c as Ne,d as P,N as Ce,e as ke,B as Ie}from"./vendor-BBk1iYZt.js";import{I as G,B as v,O as Ee,C as ze,D as ae,c as Oe,a as ie,S as A,P as le,L as Te,T as Fe,b as De}from"./primereact-D-wA2EgO.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const H="music-player",$="settings",oe="shortcuts",L={sort_by:"name",show_hidden:!1,reverse:!1};function U(){return $ in localStorage?JSON.parse(localStorage.getItem($)):(localStorage.setItem($,JSON.stringify(L)),L)}function Q(t){localStorage.setItem($,JSON.stringify(t))}function X(t,s=U()){return t.sort_by!==s.sort_by||t.reverse!==s.reverse||t.show_hidden!==s.show_hidden}function F(){return JSON.parse(localStorage.getItem(oe)??"null")}function _(t){const s=t.folders.length===0&&t.files.length===0;localStorage.setItem(oe,JSON.stringify(s?null:t))}function Re(){return H in localStorage?JSON.parse(localStorage.getItem(H)):null}function Pe(t){localStorage.setItem(H,JSON.stringify(t))}let M;const Le=t=>M=t;async function T(t,s={method:"GET"}){try{const n=await fetch(t,s);return n.status>=400?(n.status===401?M("/authentication"):M("/error",{state:await n.json()}),null):await n.json()}catch{return M("/error",{state:{code:500,status:"Server Error",message:"Server is either offline or encountered an error"}}),null}}async function Z(t=null){const s=t?"?verify="+encodeURIComponent(t):"";return await T("/authenticate"+s)}async function Ue(){const s=`path=/&show_hidden=${U().show_hidden}`;return await T("/explore?"+s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F())})}async function ee(t,s=null){let n="path="+encodeURIComponent(t);s&&(n+="&search="+encodeURIComponent(s));const i=U();return n+=`&sort_by=${i.sort_by}&show_hidden=${i.show_hidden}&reverse=${i.reverse}`,await T("/explore?"+n)}async function Ae(t){const s="path="+encodeURIComponent(t);return await T("/thumbnail?"+s)}async function $e(t){const s=new FormData;return s.append("file",t),await T("/upload",{method:"POST",body:s})}async function te(t,s){return await T("/modify/"+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}async function se(t){return await T("/total",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}function q(t,s){return"/open?"+("path="+encodeURIComponent(t)+"&stream="+s)}const _e=window&&("ontouchstart"in window||navigator.maxTouchPoints>0),Me=new Set(["jpg","jpeg","png","ico","bmp","gif","webp"]),Be=new Set(["mp3","flac","wav"]),He=new Set(["mp4","mkv","avi","mov","webm","3gp"]);function ne(t){const s=new Date(t),n=String(s.getDate()).padStart(2,"0"),i=String(s.getMonth()+1).padStart(2,"0"),o=s.getFullYear(),a=s.getHours(),l=String(s.getMinutes()).padStart(2,"0"),r=a>=12?"PM":"AM",c=String(a%12||12).padStart(2,"0");return`${n}-${i}-${o} ${c}:${l} ${r}`}function E(t){return t>1024*1024*1024?(t/1024/1024/1024).toFixed(2)+" GB":t>1024*1024?(t/1024/1024).toFixed(1)+" MB":t>1024?(t/1024).toFixed(1)+" KB":t+" B"}function k(t){return _e?void 0:t}function qe(t,s){if(!t.includes("."))return!1;const n=t.split(".").at(-1);return!!(Me.has(n.toLowerCase())||Be.has(n.toLowerCase())||He.has(n.toLowerCase())&&s==="Windows")}let I;const Ke=t=>I=t;let N=null;function K(t){N=t}function We(){N=null}const re=d.createContext(void 0);function Je({children:t}){const[s,n]=d.useState(!1),[i,o]=d.useState("/"),[a,l]=d.useState({device:{hostname:"Loading...",platform:void 0,update:{version:"?.?.?",available:!1}},clipboard:{type:"error",content:null},drives:[],shortcuts:null}),[r,c]=d.useState({folders:[],files:[]}),m=d.useCallback(async(h,y=!0)=>{try{if(n(!0),N!==null&&h===N.path){if(N.filteredItems)c({...N.filteredItems}),window.dispatchEvent(new Event("searchpagecache"));else if(N.deepSearch){const u=N.query.toLowerCase().trim(),p=await ee(h,u);if(p===null)return;c(p),K({...N,filteredItems:p})}}else if(h==="/"){const u=await Ue();if(u===null)return;u.shortcuts&&_(u.shortcuts),l(u)}else{const u=await ee(h);if(u===null)return;c(u)}y&&window.history.pushState({path:h},"","?path="+h),o(h)}catch(u){console.error(u)}finally{n(!1)}},[]),f={loading:s,path:i,home:a,setHome:l,items:r,setItems:c,explore:m};return e.jsx(re.Provider,{value:f,children:t})}function z(){const t=d.useContext(re);if(!t)throw new Error("This hook can be used inside ExplorerItemsProvider only");return t}const ce=d.createContext(void 0);function Y(){const t=d.useContext(ce);if(!t)throw new Error("This hook can be used inside SelectedItemsProvider only");return t}function B({type:t,folder:s,file:n,items:i}){const[o,a]=d.useState(!1),[l,r]=d.useState(0);return d.useEffect(()=>{(async()=>{if(t==="folder"&&s!==void 0){a(!0);const c=await se([s.path]);r(c.totalSize),a(!1);return}if(t==="items"&&i!==void 0){const c=i.files.map(f=>f.size).reduce((f,h)=>f+h,0);r(c),a(!0);const m=await se(i.folders.map(f=>f.path));r(c+m.totalSize),a(!1)}})()},[t,s,i]),e.jsxs("div",{className:"flex flex-col items-center",children:[t==="folder"&&s!==void 0&&e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("img",{src:"/icons/folder.jpg",width:"64px",className:"shadow"}),e.jsxs("div",{className:"flex flex-col text-[13px]",children:[e.jsx("h2",{className:"text-[16px] font-semibold leading-4.5 mb-1",children:s.name}),e.jsxs("span",{children:["Size: ",o?e.jsx("i",{className:"pi pi-spinner pi-spin",style:{fontSize:"12px"}}):E(l),"   ",s.hidden&&"Hidden"]}),e.jsxs("span",{children:["Date: ",ne(s.date)]})]})]}),t==="file"&&n!==void 0&&e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("img",{src:n?.thumbnail??"/icons/file.jpg",width:"64px",className:"shadow"}),e.jsxs("div",{className:"flex flex-col text-[13px] font-medium",children:[e.jsx("h2",{className:"text-[16px] font-semibold leading-4.5 mb-1",children:n.name}),e.jsxs("span",{children:["Size: ",E(n.size),"    ",n.hidden&&"Hidden"]}),e.jsxs("span",{children:["Date: ",ne(n.date)]})]})]}),t==="items"&&i!==void 0&&e.jsxs("div",{className:"flex flex-col text-center text-[14px] font-medium m-1",children:[e.jsxs("h2",{className:"text-[16px] font-semibold mb-1.5",children:[i.folders.length," Folders + ",i.files.length," Files"]}),e.jsxs("span",{children:["Total Size: ",o?e.jsxs(e.Fragment,{children:[E(l)," + ",e.jsx("i",{className:"pi pi-spinner pi-spin",style:{fontSize:"12px"}})]}):E(l)]})]})]})}function Ve({itemToRename:t,isFileItem:s,onRename:n,onCancel:i}){const[o,a]=d.useState(t.name);function l(){return!(o.trim().length===0||o===t.name||s&&!o.includes(".")||!o.trim().split(".").at(-1)||/[\\/:*?"<>|]/.test(o)||/[. ]$/.test(o)||/^(con|prn|aux|nul|com[1-9]|lpt[1-9])(\..*)?$/i.test(o))}function r(c){if(c.key==="Enter"){l()&&n(o);return}(c.key==="Escape"||c.key==="Esc")&&i()}return e.jsxs("div",{className:"flex flex-col gap-1 items-center",children:[e.jsx(G,{type:"text",placeholder:"Item Name",spellCheck:!1,autoComplete:"off",autoFocus:!0,className:"w-full m-0",style:{fontWeight:"500"},value:o,onChange:c=>a(c.target.value),onKeyDown:r}),e.jsxs("div",{className:"flex gap-5 items-center mt-5",children:[e.jsx(v,{label:"Rename",raised:!0,size:"small",style:{padding:"0.66rem"},onClick:()=>n(o),disabled:!l()}),e.jsx(v,{label:"Cancel",raised:!0,size:"small",severity:"danger",style:{padding:"0.66rem"},onClick:i})]})]})}function Ge(){const{path:t,items:s,explore:n}=z(),{selectedFiles:i,selectedFolders:o,isAnyItemSelected:a,selectAllItems:l,clearSelection:r}=Y(),c={width:"2.55rem",height:"2.5rem",padding:"0rem"},m=d.useRef(null),f=d.useRef(null),[h,y]=d.useState("none"),[u,p]=d.useState(null),[g,w]=d.useState(null),[C,O]=d.useState(!0),[de,ue]=d.useState(!1),[me,pe]=d.useState(!1),[he,fe]=d.useState(!1),[xe,ge]=d.useState(!1);d.useEffect(()=>{m.current=s},[s]),d.useEffect(()=>{const x=o.length+i.length,S=m.current?m.current.folders.length+m.current.files.length:0,j=F();if(!j)O(!0);else{const b=[...j.folders,...j.files].map(R=>R.path),D=[...o,...i].map(R=>R.path);O(!D.every(R=>b.includes(R)))}o.length===1&&i.length===0?p({type:"folder",selection:o[0]}):o.length===0&&i.length===1?p({type:"file",selection:i[0]}):x>1?p({type:"items",selection:{folders:o,files:i}}):(f.current?.hide(),p(null)),ue(o.length===0&&i.length>=2),pe(x>0&&x<S),fe(x>0),ge(x===1)},[i,o]);function je(){const x=F();let S=0;x===null?(_({folders:o,files:i}),S+=o.length+i.length):(o.forEach(j=>{x.folders.find(b=>b.path===j.path)||(x.folders.push(j),S+=1)}),i.forEach(j=>{x.files.find(b=>b.path===j.path)||(x.files.push(j),S+=1)}),_(x)),r(),window.dispatchEvent(new Event("shortcutschange")),I.show({severity:"success",summary:"Shortcuts Added",detail:S+" new item(s) added to shortcuts."})}function ve(){const x=F();let S=0;x!==null&&(o.forEach(j=>{const b=x.folders.findIndex(D=>D.path===j.path);b!==-1&&(x.folders.splice(b,1),S+=1)}),i.forEach(j=>{const b=x.files.findIndex(D=>D.path===j.path);b!==-1&&(x.files.splice(b,1),S+=1)}),_(x),r(),window.dispatchEvent(new Event("shortcutschange")),I.show({severity:"warn",summary:"Shortcuts Removed",detail:S+" item(s) removed from shortcuts."}))}async function ye(){y("donwloading");const x=[...i];x.sort((j,b)=>j.size-b.size);let S=5e3;for(const j of x)window.location.href=q(j.path,!1),await new Promise(b=>setTimeout(b,S)),S>1e3&&(S-=1e3);y("none"),r()}async function we(){const x=[...o,...i].map(j=>j.path),S=async()=>{y("deleting");const j=await te("delete",x);j&&j.count===x.length?I.show({severity:"success",summary:"Deleted",detail:j.count+" item(s) has been deleted."}):I.show({severity:"error",summary:"Deletion Failed",detail:j.count+" item(s) were deleted."}),y("none"),r(),n(t,!1)};Oe({message:`Delete ${x.length} item(s) Permanently?`,header:"Delete Confirmation",closable:!1,icon:"pi pi-exclamation-triangle",position:"center",accept:S,reject:void 0})}async function be(){const x=[...o,...i][0];w({itemToRename:x,onRename:async j=>{w(null),y("renaming");const b=await te("rename",[x.path,t+"/"+j]);b&&b.count===1?I.show({severity:"success",summary:"Renamed",detail:"Item renamed to "+j}):I.show({severity:"error",summary:"Renaming Failed",detail:x.name+" could not be renamed."}),y("none"),r(),n(t,!1)}})}return e.jsx("div",{className:"fixed inset-x-0 bottom-0 flex justify-center pointer-events-none z-10",children:e.jsxs("div",{className:`
                flex items-center gap-3 transition-all duration-300 ease-in-out 
                bg-white rounded-md shadow-lg border border-gray-300 p-3 pointer-events-auto
                ${a()?"mb-[30px] opacity-100":"translate-y-20 opacity-0"}
            `,children:[e.jsx(v,{size:"large",style:c,raised:!0,icon:"pi pi-info-circle",tooltip:k("Show Details"),tooltipOptions:{position:"top"},onClick:x=>f.current?.toggle(x)}),he&&t!=="/"&&e.jsx(v,{size:"large",style:c,raised:!0,icon:`pi ${h==="deleting"?"pi-spin pi-spinner":"pi-trash"}`,tooltip:k("Delete"),tooltipOptions:{position:"top"},onClick:()=>h==="none"&&we()}),xe&&t!=="/"&&e.jsx(v,{size:"large",style:c,raised:!0,icon:`pi ${h==="renaming"?"pi-spin pi-spinner":"pi-pen-to-square"}`,tooltip:k("Rename"),tooltipOptions:{position:"top"},onClick:()=>h==="none"&&be()}),de&&e.jsx(v,{size:"large",style:c,raised:!0,icon:`pi ${h==="donwloading"?"pi-spin pi-spinner":"pi-download"}`,tooltip:k("Download All"),tooltipOptions:{position:"top"},onClick:()=>h==="none"&&ye()}),e.jsx(v,{size:"large",style:c,raised:!0,pt:{icon:{className:C?"rotate-0":"rotate-180"}},icon:"pi pi-thumbtack",severity:C?void 0:"danger",tooltip:k(C?"Add Shortcuts":"Remove Shortcuts"),tooltipOptions:{position:"top"},onClick:()=>C?je():ve()}),me&&t!=="/"&&e.jsx(v,{size:"large",style:c,raised:!0,icon:"pi pi-list-check",tooltip:k("Select All"),tooltipOptions:{position:"top"},onClick:l}),e.jsx(v,{size:"large",style:c,raised:!0,icon:"pi pi-times",severity:"danger",tooltip:k("Clear"),tooltipOptions:{position:"top"},onClick:r}),e.jsx(Ee,{ref:f,showCloseIcon:!0,closeOnEscape:!0,dismissable:!1,className:"max-w-[80%]",children:u?.type==="folder"?e.jsx(B,{type:"folder",folder:u.selection}):u?.type==="file"?e.jsx(B,{type:"file",file:u.selection}):e.jsx(B,{type:"items",items:u?.selection})}),e.jsx(ze,{}),g!==null&&e.jsx(ae,{header:"Rename Item",pt:{root:{className:"w-[95%] md:w-[60%] lg:w-[34%]"}},visible:g!==null,onHide:()=>w(null),children:e.jsx(Ve,{itemToRename:g.itemToRename,isFileItem:i.length===1&&o.length===0,onRename:g.onRename,onCancel:()=>w(null)})})]})})}function Ye(){const{path:t,home:s,explore:n}=z(),[i,o]=d.useState([]);d.useEffect(()=>{const l=[];let r=[];if(s.device.platform==="Android"){const c="/storage/emulated/0";r=t.replace(c,"IS:").split("/"),l.push({label:"IS:",path:c})}s.device.platform==="Windows"&&(r=t.split("/"),l.push({label:r[0],path:r[0]+"/"}));for(let c=1;c<r.length;c++){if(r[c].trim().length===0)continue;const m=l[c-1].path.endsWith("/")?"":"/",f=l[c-1].path+m+r[c];l.push({label:r[c],path:f})}o(l)},[t,s.device.platform]);function a(l,r){return e.jsxs("span",{children:[e.jsx("span",{className:"hover:text-blue-700 cursor-pointer",onClick:()=>n(l.path,!0),children:l.label}),!r&&e.jsx("span",{className:"mx-1.5",children:"/"})]},l.path)}return e.jsx("div",{className:"flex flex-wrap items-center text-[15px] leading-5 border border-gray-300 rounded shadow m-3 p-3",children:i.map((l,r)=>a(l,i.length===r+1))})}function Qe({drive:t}){const{explore:s}=z();return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:"/icons/drive.jpg",className:"w-[60px] h-[50px] m-1 p-0 rounded-[5px]"}),e.jsxs("div",{className:"w-full flex flex-col my-1 gap-1.75 group cursor-pointer",onClick:()=>s(t.path,!0),children:[e.jsxs("span",{className:"font-medium group-hover:text-blue-700 leading-3.75 min-w-0 break-words break-all",children:[t.letter!==null&&e.jsxs("span",{className:"mr-1.5",children:[t.letter,":"]}),t.label]}),e.jsxs("div",{className:"flex gap-4 text-[10px] tracking-wider ml-0.25",children:[e.jsxs("span",{children:["Free ",E(t.size.free)]}),e.jsxs("span",{children:["Used ",E(t.size.used)]}),e.jsxs("span",{children:["Total ",E(t.size.total)]})]})]})]})}function W({file:t,selectable:s=!0,onMusicPlay:n}){const[i,o]=d.useState(!1),{toggleFileSelection:a,isItemSelected:l,isAnyItemSelected:r}=Y();function c(u){return u.includes(".")?u.split(".").at(-1).toUpperCase():""}function m(u){const p=c(u);return!t.thumbnail&&p.length>0&&p.length<=4}function f(u){const p=c(u).length;return p>3?"text-xs":p>2?"text-sm":p>1?"text-lg":"text-2xl"}function h(u){if(i)return;o(!0),window.location.href=q(u.path,!1);const p=Math.max(1,u.size/1024/1024);setTimeout(()=>o(!1),p)}function y(u){if(u.mimetype==="application/octet-stream"){I.show({severity:"info",summary:"Cannot Open "+c(u.name),detail:"This file can only be downloaded"});return}n&&u.mimetype.startsWith("audio")?n(u):window.open(q(u.path,!0))}return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-[58px] h-[50px] overflow-hidden m-1 p-0  ${s&&"cursor-pointer"} ${t.hidden&&"opacity-70"}`,onClick:()=>s&&a(t),children:m(t.name)?e.jsx("div",{className:`w-full h-full flex justify-center items-center rounded-[5px] bg-gray-500 text-white font-bold tracking-wide ${f(t.name)}`,children:c(t.name)}):e.jsx("img",{src:t.thumbnail??"/icons/file.jpg",className:"w-full h-full object-contain object-center rounded-[5px]"})}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex flex-col my-1 gap-1.5 group cursor-pointer justify-between",onClick:()=>y(t),children:[e.jsx("span",{className:"group-hover:text-blue-700 text-sm leading-3.75 min-w-0 break-words break-all",children:t.name}),e.jsx("div",{className:"flex gap-4 text-[10px] tracking-wider ml-0.25",children:e.jsxs("span",{children:["Size ",E(t.size)]})})]}),e.jsx("div",{className:"ml-2 mr-1 z-0",children:s&&r()?e.jsx(ie,{checked:l(t),onChange:()=>a(t),style:{zoom:1.2},tooltip:k(l(t)?"Unselect":"Select"),tooltipOptions:{position:"left"}}):e.jsx(v,{icon:`pi ${i?"pi-spin pi-spinner":"pi-download"}`,style:{width:"2rem",height:"2rem",padding:"0rem"},tooltip:k(i?"Downloading":"Download"),tooltipOptions:{position:"left"},onClick:()=>h(t)})})]})]})}function J({folder:t,selectable:s=!0}){const{explore:n}=z(),{toggleFolderSelection:i,isItemSelected:o,isAnyItemSelected:a}=Y();function l(){o(t)?I.show({severity:"warn",summary:"Folder Selected",detail:"Cannot explore (or open) a selected folder."}):n(t.path,!0)}return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:"/icons/folder.jpg",className:`w-[50px] h-[50px] m-1 p-0 rounded-[5px] ${s&&"cursor-pointer"} ${t.hidden&&"opacity-70"}`,onClick:()=>s&&i(t)}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex flex-col my-1 gap-1.5 group cursor-pointer",onClick:l,children:[e.jsx("span",{className:"font-medium group-hover:text-blue-700 text-sm leading-3.75 min-w-0 break-words break-all",children:t.name}),e.jsxs("div",{className:"flex gap-4 text-[10px] tracking-wider ml-0.25",children:[e.jsxs("span",{children:["Folders ",t.count[0]]}),e.jsxs("span",{children:["Files ",t.count[1]]})]})]}),s&&a()&&e.jsx("div",{className:"ml-2 mr-1 z-0",children:e.jsx(ie,{checked:o(t),onChange:()=>i(t),style:{zoom:1.2},tooltip:k(o(t)?"Unselect":"Select"),tooltipOptions:{position:"left"}})})]})]})}function Xe(){const{home:t}=z(),{folders:s,files:n}=t.clipboard.type==="items"?t.clipboard.content:[[],[]],[i,o]=d.useState(F());return d.useEffect(()=>{const a=()=>o(F());return window.addEventListener("shortcutschange",a),()=>window.removeEventListener("shortcutschange",a)},[]),e.jsxs("div",{className:"mb-4 mx-3",children:[t.device.update.available&&e.jsxs("div",{className:"mt-4 border border-gray-300 rounded shadow",children:[e.jsx("div",{className:"m-0 p-2 bg-gray-200 font-bold",children:e.jsx("span",{className:"mx-1",children:"Warning"})}),e.jsxs("div",{className:"m-1 p-2 flex gap-1.5 items-center justify-center text-[15px]",children:[e.jsx("img",{src:"/favicon.ico",width:"20px"}),e.jsxs("span",{children:["MyFileServer ",e.jsxs("b",{children:["v",t.device.update.version]})," update is available"]})]})]}),t.drives.length>0&&e.jsxs("div",{className:"mt-4 border border-gray-300 rounded shadow",children:[e.jsx("div",{className:"m-0 p-2 bg-gray-200 font-bold",children:e.jsx("span",{className:"mx-1",children:"Drives"})}),t.drives.map((a,l)=>e.jsxs("div",{className:"mx-1",children:[l===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(Qe,{drive:a}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path))]}),i!==null&&e.jsxs("div",{className:"mt-4 border border-gray-300 rounded shadow",children:[e.jsx("div",{className:"m-0 p-2 bg-gray-200 font-bold",children:e.jsx("span",{className:"mx-1",children:"Shortcuts"})}),e.jsxs(e.Fragment,{children:[i.folders.map((a,l)=>e.jsxs("div",{className:"mx-1",children:[l===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(J,{folder:a,selectable:!0}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path)),i.files.map((a,l)=>e.jsxs("div",{className:"mx-1",children:[l===0&&i.folders.length===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(W,{file:a,selectable:!0}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path))]})]}),t.clipboard.type!=="error"&&e.jsxs("div",{className:"mt-4 border border-gray-300 rounded shadow",children:[e.jsx("div",{className:"m-0 p-2 bg-gray-200 font-bold flex justify-between",children:e.jsx("span",{className:"mx-1",children:"Clipboard"})}),t.clipboard.type==="items"&&e.jsxs(e.Fragment,{children:[s.map((a,l)=>e.jsxs("div",{className:"mx-1",children:[l===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(J,{folder:a,selectable:!1}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path)),n.map((a,l)=>e.jsxs("div",{className:"mx-1",children:[l===0&&s.length===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(W,{file:a,selectable:!1}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path))]}),t.clipboard.type==="text"&&e.jsx("pre",{contentEditable:!0,suppressContentEditableWarning:!0,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",className:"p-3 font-mono text-sm whitespace-pre overflow-x-auto break-keep select-text outline-none focus:outline-none focus:ring-0",children:t.clipboard.content})]})]})}function Ze(){return e.jsxs("div",{className:"h-[66vh] flex flex-col justify-center items-center text-center text-2xl text-gray-600",children:[e.jsx("img",{src:"/icons/empty-folder.png",width:"180px"}),e.jsx("div",{className:"my-8 font-semibold",children:"Empty Folder"})]})}function et(){const{home:t,items:s}=z(),[n,i]=d.useState([]);d.useEffect(()=>{i([...s.files]);let a=!0;return(async()=>{for(const l of s.files){if(l.thumbnail||!qe(l.name,t.device.platform))continue;const r=await Ae(l.path);if(r===null)return;if(r.thumbnail&&(i(c=>{const m=c.find(f=>f.path===r.filepath);return m&&(m.thumbnail=r.thumbnail),m?[...c]:c}),!a))break}})(),()=>{a=!1}},[s.files,t.device.platform]);function o(a){const l=n.filter(m=>m.mimetype.startsWith("audio")),r=l.findIndex(m=>m.path===a.path);Pe({songs:l,index:r}),window.open("/music-player","music-player");const c=new BroadcastChannel("music_channel");c.postMessage(null),setTimeout(()=>c.close(),1e3)}return e.jsx(e.Fragment,{children:s.folders.length===0&&s.files.length===0?e.jsx(Ze,{}):e.jsxs(e.Fragment,{children:[s.folders.map((a,l)=>e.jsxs("div",{className:"mx-2",children:[l===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(J,{folder:a,selectable:!0}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path)),n.map((a,l)=>e.jsxs("div",{className:"mx-2",children:[l===0&&s.folders.length===0&&e.jsx("hr",{className:"text-gray-300 m-1"}),e.jsx(W,{file:a,selectable:!0,onMusicPlay:o}),e.jsx("hr",{className:"text-gray-300 m-1"})]},a.path))]})})}function tt(){const{path:t,items:s,setItems:n,explore:i}=z(),o=d.useRef(null),a=d.useRef(null),[l,r]=d.useState(""),[c,m]=d.useState(!1),[f,h]=d.useState("none");d.useEffect(()=>{o.current=t,a.current=f,N!==null&&t!==N.path&&(r(""),m(!1),h("none"))},[t,f]);async function y(){if(f==="searching")return;h("searching");const g=l.toLowerCase().trim(),w=N?N.originalItems:s;if(c)K({query:l,deepSearch:c,path:t,originalItems:w,filteredItems:null}),await i(t);else{const C={folders:w.folders.filter(O=>O.name.toLowerCase().includes(g)),files:w.files.filter(O=>O.name.toLowerCase().includes(g))};n(C),K({query:l,deepSearch:c,path:t,originalItems:w,filteredItems:C})}h("searched")}const u=d.useCallback(async()=>{r(""),m(!1),h("none"),We(),a.current!=="none"&&o.current&&await i(o.current,!1)},[i]);function p(g){if(g.key==="Enter"){l.trim().length&&f==="none"&&y();return}(g.key==="Escape"||g.key==="Esc")&&u()}return d.useEffect(()=>{const g=()=>{N!==null&&(r(N.query),m(N.deepSearch),h("searched"))};return addEventListener("searchpagecache",g),addEventListener("searchpanelclose",u),()=>{removeEventListener("searchpagecache",g),removeEventListener("searchpanelclose",u)}},[u]),e.jsxs("div",{className:"flex mt-4 mb-2 mx-1",children:[e.jsxs("div",{className:"flex-3",children:[e.jsx("span",{className:"block ml-0.5 mb-1 text-sm",children:"Deep Search"}),e.jsx(A,{value:c,className:"selectbutton",allowEmpty:!1,options:[{label:"On",value:!0},{label:"Off",value:!1}],optionLabel:"label",optionValue:"value",onChange:g=>{m(g.value),h("none")}})]}),e.jsxs("div",{className:"flex-7",children:[e.jsx("span",{className:"block ml-0.75 mb-1 text-sm",children:c?"Search all the items recursively":"Search items on this page only"}),e.jsxs("div",{className:"p-inputgroup",children:[e.jsx(G,{placeholder:"Search Items",style:{fontSize:"14px"},spellCheck:!1,autoComplete:"off",value:l,onChange:g=>{r(g.target.value),h("none")},onKeyDown:p}),e.jsx(v,{icon:`pi ${f==="searching"?"pi-spin pi-spinner":f==="none"?"pi-search":"pi-times"}`,style:{width:"2.5rem"},disabled:f==="searching"||l.trim().length===0,onClick:()=>f==="none"?y():u()})]})]})]})}function st(){const t=d.useRef(!1),s=d.useRef(null),[n,i]=d.useState([]),[o,a]=d.useState(!1),[l,r]=d.useState("Upload"),[c,m]=d.useState({count:0,size:0,total:0});function f(p){if(!p.target.files)return;const g=Array.from(p.target.files).map(w=>({file:w,status:"pending"}));g.sort((w,C)=>w.file.size-C.file.size),i(g),r("Upload"),m(w=>({...w,total:g.map(C=>C.file.size).reduce((C,O)=>C+O,0)}))}async function h(){a(!0),r("Uploading"),t.current=!1;for(let p=0;p<n.length&&!t.current;p++){if(!["pending","failed"].includes(n[p].status))continue;n[p].status="uploading",i([...n]);const g=await $e(n[p].file);if(t.current)break;n[p].status=g.status,i([...n]),n[p].status==="uploaded"&&m(w=>({...w,count:w.count+1,size:w.size+n[p].file.size}))}r("Uploaded"),setTimeout(()=>{i(p=>p.filter(g=>g.status!=="uploaded")),a(!1),r("Upload"),m({count:0,size:0,total:0})},1e3),I.show({severity:"success",summary:"Uploaded Successfully",detail:u(n.length)+" uploaded and saved to the Download folder of the server device."})}function y(){t.current=!0,i([]),a(!1),r("Upload"),m({count:0,size:0,total:0}),I.show({severity:"warn",summary:"Uploading Cancelled",detail:"Pending files will not be uploaded. Selection is cleared"})}function u(p){return p+(p<2?" file":" files")}return e.jsxs("div",{className:"flex flex-col gap-2 mb-1",children:[e.jsx("input",{ref:s,type:"file",multiple:!0,className:"hidden",onChange:f}),e.jsxs("div",{className:"flex items-center gap-3 mt-4 mb-1 selectbutton",children:[e.jsx(v,{label:"Choose",icon:"pi pi-plus",size:"small",onClick:()=>s.current?.click(),disabled:n.length>0||o}),e.jsx(v,{label:l,size:"small",icon:l==="Uploading"?"pi pi-spin pi-spinner":l==="Uploaded"?"pi pi-check":"pi pi-upload",onClick:h,disabled:n.length===0||o}),e.jsx(v,{label:"Cancel",icon:"pi pi-times",size:"small",severity:"danger",onClick:y,disabled:n.length===0})]}),e.jsx("div",{className:"text-center text-sm my-1",children:n.length===0?o?e.jsx("div",{children:"Uploading cancelled"}):e.jsx("div",{children:"No file selected for upload"}):o?e.jsxs("div",{className:"flex flex-col gap-1.25",children:[e.jsxs("div",{children:["Uploaded ",e.jsx("b",{children:u(c.count)})," [",E(c.size),"] out of ",e.jsx("b",{children:u(n.length)})," [",E(c.total),"]"]}),e.jsxs("div",{children:[e.jsxs("b",{children:[Math.round(100*c.size/c.total),"%"]})," complete"]})]}):e.jsxs("div",{children:[u(n.length)," [",E(c.total),"] selected for upload"]})})]})}function nt(){const{path:t,explore:s}=z(),[n,i]=d.useState(U());d.useEffect(()=>{const m=()=>i(U());return addEventListener("settingspanelclose",m),()=>{removeEventListener("settingspanelclose",m)}},[]);const o=[{label:"Name",value:"name"},{label:"Type",value:"type"},{label:"Date",value:"date"},{label:"Size",value:"size"}],a=[{label:"Asc",value:!1},{label:"Dec",value:!0}],l=[{label:"Show",value:!0},{label:"Hide",value:!1}];function r(){Q(n),s(t,!1)}function c(){i(L),Q(L),s(t,!1)}return e.jsxs("div",{className:"flex flex-col gap-4 mt-4 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block ml-0.75 mb-1 text-sm",children:"Sort Items By"}),e.jsx(A,{value:n.sort_by,className:"selectbutton",options:o,optionLabel:"label",optionValue:"value",allowEmpty:!1,onChange:m=>i({...n,sort_by:m.value})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block ml-0.75 mb-1 text-sm",children:"Sort Order"}),e.jsx(A,{value:n.reverse,className:"selectbutton",options:a,optionLabel:"label",optionValue:"value",allowEmpty:!1,onChange:m=>i({...n,reverse:m.value})})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block ml-0.75 mb-1 text-sm",children:"Hidden Items"}),e.jsx(A,{value:n.show_hidden,className:"selectbutton",options:l,optionLabel:"label",optionValue:"value",allowEmpty:!1,onChange:m=>i({...n,show_hidden:m.value})})]}),e.jsxs("div",{className:"selectbutton",children:[e.jsx("span",{className:"block ml-0.25 mb-1 text-sm",children:"Save or Restore Defaults"}),e.jsx(v,{label:"Reset",icon:"pi pi-refresh",size:"small",style:{marginRight:"0.6rem"},disabled:!X(n,L),onClick:c}),e.jsx(v,{label:"Save",icon:"pi pi-save",size:"small",disabled:!X(n),onClick:r})]})]})]})}function at(){const{path:t,home:s,explore:n}=z(),i={width:"2.55rem",height:"2.5rem",padding:"0rem"},o=s.device.platform===void 0?"pi pi-spin pi-spinner":s.device.platform==="Android"?"pi pi-mobile":"pi pi-desktop",[a,l]=d.useState(!1),[r,c]=d.useState(null);d.useEffect(()=>{t==="/"&&(l(!1),setTimeout(()=>c(null),333));const f=()=>{c("search"),l(!0)};return addEventListener("searchpagecache",f),()=>{removeEventListener("searchpagecache",f)}},[t]);function m(f){a?f===r?(l(!1),setTimeout(()=>{c(null),dispatchEvent(new Event(f+"panelclose"))},333)):c(f):(c(f),l(!0))}return e.jsxs("div",{className:"flex flex-col items-center border border-gray-300 rounded shadow m-3 p-2",children:[e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center hover:text-blue-700 cursor-pointer",onClick:()=>n("/",!0),children:[e.jsx("i",{className:`${o} m-2 mr-2.25 shadow`,style:{fontSize:"1.75rem"}}),e.jsx("span",{className:"text-xl font-normal",children:s.device?.hostname})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"mr-3",children:e.jsx(v,{size:"large",style:i,raised:!0,icon:a&&r==="upload"?"pi pi-times":"pi pi-upload",severity:a&&r==="upload"?"danger":void 0,tooltip:k("Upload"),tooltipOptions:{position:"bottom"},onClick:()=>m("upload")})}),e.jsx("div",{className:t==="/"?"hidden":"mr-3",children:e.jsx(v,{size:"large",style:i,raised:!0,icon:a&&r==="search"?"pi pi-times":"pi pi-search",severity:a&&r==="search"?"danger":void 0,tooltip:k("Search"),tooltipOptions:{position:"bottom"},onClick:()=>m("search")})}),e.jsx("div",{className:"mr-1",children:e.jsx(v,{size:"large",style:i,raised:!0,icon:a&&r==="settings"?"pi pi-times":"pi pi-cog",severity:a&&r==="settings"?"danger":void 0,tooltip:k("Settings"),tooltipOptions:{position:"left"},onClick:()=>m("settings")})})]})]}),e.jsxs("div",{className:`${a?"max-h-[50vh] opacity-100":"max-h-0 opacity-50"} overflow-hidden transition-all duration-300 ease-in-out`,children:[e.jsx("div",{className:r==="upload"?"block":"hidden",children:e.jsx(st,{})}),e.jsx("div",{className:r==="search"?"block":"hidden",children:e.jsx(tt,{})}),e.jsx("div",{className:r==="settings"?"block":"hidden",children:e.jsx(nt,{})})]})]})}function it({children:t}){const{items:s}=z(),[n,i]=d.useState([]),[o,a]=d.useState([]);function l(u){i(p=>c(u)?p.filter(g=>g.path!==u.path):[...p,u])}function r(u){a(p=>c(u)?p.filter(g=>g.path!==u.path):[...p,u])}function c(u){return!!(n.find(p=>p.path===u.path)||o.find(p=>p.path===u.path))}function m(){return n.length>0||o.length>0}function f(){i(s.folders),a(s.files)}function h(){i([]),a([])}const y={selectedFolders:n,selectedFiles:o,toggleFolderSelection:l,toggleFileSelection:r,isItemSelected:c,isAnyItemSelected:m,selectAllItems:f,clearSelection:h};return e.jsx(ce.Provider,{value:y,children:t})}function lt(){const t=V(),{loading:s,path:n,explore:i}=z();return d.useEffect(()=>{const a=new URLSearchParams(window.location.search).get("path");(async()=>a?(await i("/",!1),a!=="/"&&await i(a,!1)):await i("/",!0))();const l=async r=>{r.preventDefault(),await i(r.state.path,!1)};return window.addEventListener("popstate",l),()=>window.removeEventListener("popstate",l)},[i,t]),e.jsx("div",{className:"w-full flex justify-center",children:e.jsxs("div",{className:"bg-gray-50 min-h-screen w-full md:w-[60%] lg:w-[34%] rounded-md",children:[e.jsxs("div",{className:"sticky top-0 bg-gray-50 z-10",children:[e.jsx(at,{}),n!=="/"&&e.jsx(Ye,{})]}),e.jsxs(it,{children:[s?e.jsx("div",{className:"h-[66%] flex justify-center items-center",children:e.jsx(le,{strokeWidth:"0.2rem",animationDuration:"0.5s"})}):n==="/"?e.jsx(Xe,{}):e.jsx(et,{}),e.jsx(Ge,{})]})]})})}function ot(){const t=V(),[s,n]=d.useState(""),[i,o]=d.useState(!1);d.useEffect(()=>{(async()=>{const r=await Z();r!==null&&r.status==="generated"&&o(!0)})()},[]);async function a(){(await Z(s)).status==="verified"?t("/"):(n(""),I.show({severity:"warn",summary:"Invalid Token",detail:"Please enter the valid server-generated token."}))}function l(r){if(r.key==="Enter"){a();return}(r.key==="Escape"||r.key==="Esc")&&n("")}return e.jsx("div",{className:"w-full flex justify-center",children:e.jsx("div",{className:"bg-gray-50 min-h-screen w-full md:w-[60%] lg:w-[34%]",children:e.jsxs("div",{className:"h-[90%] flex flex-col justify-center items-center gap-2",children:[e.jsx("label",{htmlFor:"token",className:"mb-4 font-semibold text-center text-3xl text-gray-800",children:"Token Required"}),e.jsx("img",{src:"/icons/token-required.png",width:"150px",className:"mt-2 mb-4"}),e.jsx(G,{id:"token","aria-describedby":"token-info",required:!0,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",value:s,autoFocus:!0,onKeyDown:l,onChange:r=>n(r.target.value.toUpperCase()),style:{border:"1px solid blue",textAlign:"center",fontSize:"larger",fontWeight:"bold",letterSpacing:"0.25rem",padding:"0.5rem",marginTop:"1rem",width:"13ch"}}),e.jsx("small",{id:"token-info",className:"text-sm font-light",children:i?"Enter the token shown in the server logs":"Generating unique token... Please wait..."}),e.jsx(v,{label:"Verify",style:{marginTop:"1rem"},disabled:s.trim().length===0||!i,onClick:a})]})})})}function rt(){const t=Se().state;return e.jsxs("div",{className:"h-[85vh] flex flex-col justify-center items-center text-center text-gray-100 m-4",children:[e.jsx("div",{className:"mb-2 font-bold tracking-wider text-4xl",children:t.code}),e.jsx("div",{className:"mb-4 font-semibold tracking-wide text-xl",children:t.status.toUpperCase()}),t.message&&e.jsx("span",{className:"mt-8 text-sm font-mono",children:t.message})]})}function ct(){const[t,s]=d.useState([]),[n,i]=d.useState(-1),[o,a]=d.useState(!1),[l,r]=d.useState(!1);d.useEffect(()=>{const h=()=>{const u=Re();u&&(s(u.songs),i(u.index))};h();const y=new BroadcastChannel("music_channel");return y.onmessage=h,()=>y.close()},[]);function c(h){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:h.thumbnail??"/icons/file.jpg",width:"40px",height:"40px",className:"rounded-[4px]"}),e.jsx("span",{className:"font-medium text-[15px] leading-5 min-w-0 break-words",children:h.name.substring(0,h.name.lastIndexOf("."))})]})}function m(){n<t.length-1&&i(n+1),a(!1)}function f(){n>0&&i(n-1),a(!1)}return e.jsx("div",{className:"w-full flex justify-center text-gray-50",children:e.jsx("div",{className:"min-h-[92vh] w-[92%] md:w-[60%] lg:w-[34%] rounded-md",children:n===-1||t.length===0?e.jsx("div",{className:"h-[90%] flex justify-center items-center",children:e.jsx(le,{strokeWidth:"0.2rem",animationDuration:"0.5s"})}):e.jsxs("div",{className:"h-full flex flex-col gap-4 justify-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{width:"70px",height:"70px",src:t[n].thumbnail??"/icons/file.jpg",className:o?"rounded-full animate-[spin_3s_linear_infinite]":"rounded-[8px]"}),e.jsxs("div",{className:"flex flex-col gap-1 group cursor-pointer",children:[e.jsx("span",{className:"text-lg leading-5.5 font-semibold min-w-0 break-words",children:t[n].name.substring(0,t[n].name.lastIndexOf("."))}),e.jsx("div",{className:"flex text-[13px] tracking-wider ml-0.25",children:e.jsxs("span",{children:["Size ",E(t[n].size)]})})]})]}),e.jsx("audio",{autoPlay:!0,controls:!0,className:"w-full h-12",src:`/open?path=${encodeURIComponent(t[n].path)}&stream=true`,onPlay:()=>a(!0),onPause:()=>a(!1),onEnded:m}),e.jsxs("div",{className:"flex justify-between items-center w-full h-12 gap-2",children:[e.jsx(v,{label:"Prev",icon:"pi pi-arrow-left",size:"small",severity:"secondary",raised:!0,disabled:n<=0,onClick:f}),e.jsx(v,{label:"Playlist",size:"small",severity:"secondary",raised:!0,icon:l?"pi pi-spin pi-spinner":"pi pi-list",disabled:l,onClick:()=>r(!l)}),e.jsx(v,{label:"Next",icon:"pi pi-arrow-right",iconPos:"right",size:"small",severity:"secondary",raised:!0,disabled:n>=t.length-1,onClick:m})]}),e.jsx(ae,{header:"Playlist ("+t.length+" Songs)",pt:{root:{className:"w-[95%] md:w-[60%] lg:w-[34%]"}},contentStyle:{padding:"0px",margin:"0px"},visible:l,onHide:()=>r(!1),children:e.jsx(Te,{filter:!0,optionLabel:"name",optionValue:"path",filterBy:"name",itemTemplate:h=>c(h),options:t,value:t[n].path,onChange:h=>i(t.findIndex(y=>y.path===h.value))})})]})})})}function dt(){const t=d.useRef(null),s=V();return d.useEffect(()=>{t.current&&Ke(t.current),Le(s)},[s]),e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(P,{path:"/",element:e.jsx(Je,{children:e.jsx(lt,{})})}),e.jsx(P,{path:"/authentication",element:e.jsx(ot,{})}),e.jsx(P,{path:"/music-player",element:e.jsx(ct,{})}),e.jsx(P,{path:"/error",element:e.jsx(rt,{})}),e.jsx(P,{path:"*",element:e.jsx(Ce,{to:"/error",state:{code:404,status:"Page Not Found"},replace:!0})})]}),e.jsx(Fe,{ref:t,position:"center"})]})}ke.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(De,{value:{ripple:!0},children:e.jsx(Ie,{children:e.jsx(dt,{})})})}));
